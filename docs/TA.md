
Техническое задание

Backend API системы бронирования студии с интеграцией Google Calendar

⸻

1. Общая информация

1.1 Назначение системы

Разработка backend API для системы онлайн-бронирования студии по дням и фиксированным временным слотам (09:00, 10:00, 11:00 и т.д.) с синхронизацией данных с Google Calendar.

Backend должен:
	•	предоставлять API для фронтенда
	•	хранить актуальные данные о бронированиях
	•	предотвращать двойные бронирования
	•	синхронизироваться с Google Calendar

⸻

1.2 Технологический стек
	•	Язык: PHP 8.x
	•	Framework: Laravel (рекомендуется)
	•	База данных: MySQL / PostgreSQL
	•	Внешние сервисы: Google Calendar API
	•	Формат API: REST, JSON
	•	Аутентификация: не требуется (или JWT / API Key — по согласованию)

⸻

2. Архитектура

2.1 Общая схема

Frontend → Backend API → Database
                     ↕
                Google Calendar

2.2 Источник истины

Основным источником данных является база данных backend.
Google Calendar используется для отображения и внешней синхронизации, но не для принятия решений о доступности слотов.

⸻

3. Бизнес-логика бронирования

3.1 Временные слоты
	•	Слоты фиксированные, длительность — 1 час
	•	Диапазон: 09:00–21:00 (настраиваемо)
	•	Список слотов задаётся конфигурацией приложения

⸻

3.2 Правила бронирования
	•	Один слот может быть забронирован только один раз
	•	Бронирование в прошлом запрещено
	•	Возможна отмена бронирования (опционально)
	•	Таймзона задаётся явно (например, Europe/Moscow)

⸻

4. Модель данных

4.1 Таблица bookings

Поле	Тип	Описание
id	BIGINT	ID бронирования
date	DATE	Дата бронирования
slot_start	TIME	Время начала
slot_end	TIME	Время окончания
status	ENUM	confirmed / cancelled
google_event_id	VARCHAR	ID события Google
created_at	DATETIME	Дата создания
updated_at	DATETIME	Дата обновления

Ограничения:
	•	Уникальный индекс (date, slot_start)

⸻

5. API интерфейсы

5.1 Получение доступности слотов

Endpoint:

GET /api/availability

Параметры:
	•	date (YYYY-MM-DD) — обязательный

Ответ:

{
  "date": "2026-02-20",
  "slots": {
    "09:00": false,
    "10:00": true,
    "11:00": false
  }
}

Где:
	•	true — слот занят
	•	false — слот свободен

⸻

5.2 Создание бронирования

Endpoint:

POST /api/bookings

Тело запроса:

{
  "date": "2026-02-20",
  "slot": "10:00"
}

Ответ (успех):

{
  "id": 123,
  "status": "confirmed"
}

Ошибки:
	•	409 Conflict — слот уже занят
	•	422 Unprocessable Entity — неверные данные
	•	500 — ошибка Google Calendar

⸻

5.3 Отмена бронирования (опционально)

DELETE /api/bookings/{id}


⸻

6. Интеграция с Google Calendar

6.1 Создание события
	•	Одно событие = одно бронирование
	•	Время события соответствует временному слоту
	•	google_event_id сохраняется в БД

⸻

6.2 Синхронизация

Способ синхронизации
	•	Cron-задача каждые 5–10 минут
	•	Диапазон синхронизации: текущий месяц + следующий

Логика
	•	Получить список событий из Google Calendar
	•	Сопоставить с локальными бронированиями
	•	Обновить статусы отменённых событий

⸻

7. Транзакционность

При создании бронирования:
	1.	Открывается транзакция БД
	2.	Проверяется доступность слота
	3.	Создаётся запись бронирования
	4.	Создаётся событие в Google Calendar
	5.	Обновляется google_event_id
	6.	Транзакция фиксируется

При ошибке — откат транзакции.

⸻

8. Безопасность и ограничения
	•	Валидация входных данных
	•	Защита от повторных запросов (rate limit)
	•	Ограничение бронирования в прошлом
	•	Логирование ошибок Google API

⸻

9. Администрирование (минимально)
	•	Конфигурация временных слотов
	•	Настройка Google API credentials
	•	Логи синхронизации

⸻

10. План работ

Этап 1. Проектирование
	•	Подтверждение бизнес-логики
	•	Финализация API контрактов

Этап 2. Реализация Backend
	•	Настройка проекта
	•	Модели и миграции
	•	API эндпоинты
	•	Логика бронирования

Этап 3. Google Calendar
	•	Интеграция API
	•	Создание событий
	•	Синхронизация

Этап 4. Тестирование
	•	Тесты бронирования
	•	Проверка гонок (double booking)
	•	Тесты синхронизации

Этап 5. Документация и деплой
	•	Swagger / OpenAPI
	•	Инструкция по развёртыванию

⸻

11. Критерии приёмки
	•	❌ невозможно создать двойное бронирование
	•	✅ фронтенд получает корректную доступность
	•	✅ бронирование появляется в Google Calendar
	•	✅ отмена в Google отражается в системе
	•	✅ ошибки обрабатываются корректно
